<!doctype html>
<html>
	<head>
		<script src="funcs.js" type="text/javascript" language="javascript"></script>
		<script src="http://www.json.org/json2.js" type="text/javascript" language="javascript"></script>
		<script>
			
			/*
			Javascript implementation of something similar to rdf turtle representation
			*/
			function test() {
				var expression1 = [ ':a', [ ':b', ':c', ':d', [ ':e', ':f' ] ] ];
				var expression2 = [ ':a', ':b', [ ':c', ':d', ':e', ':f' ] ];				
 
				var trips = [];
				// parse( expression1, trips );
				// parse2( expression1 );
				var result1 = parse4( expression1 );
				var result2 = parse4( expression2 );
				
				console.log( trips );
			}
			
			function parse4( expr, level ) {
				level = level || 3;
				var ret = [];
				var temp = [];
				for( var i=0; i < expr.length; i++ ) {
					if( typeOf( expr[i] ) == 'array' ) {
						ret = concat( 
							ret, 
							product( 
								[ temp ], 
								parse4( 
									expr[i], 
									3 - temp.length
								)
							) 
						);
					}
					else {
						temp.push( expr[i] );
						if( temp.length == level ) {
							ret.push( temp );
							temp = [];
						}
					}
				}
				return ret;
			}
			
			function parse3( expr, level ) {
				level = level || 0;
				var head = [];
				var tail = [];
				var ret = [];
				for( var i=0; i < expr.length; i++ ) {
					if( typeOf( expr[i] ) != 'array' ) {
						head.push( expr[i] );
					}
					else {
						tail = parse3( expr[i], level + 1 );
					}
				}
				for( var j=0; j < tail.length; j++ ) {
					ret.push( head.concat( tail[j] ) );
				}
				return ret;
			}
			
			function parse2( expr ) {
				var head = [];
				var tail = [];
				var ret = [];
				for( var i=0; i < expr.length; i++ ) {
					if( typeOf( expr[i] ) != 'array' ) {
						head.push( expr[i] );
					}
					else {
						tail = parse2( expr[i] );
					}
				}
				for( var j=0; j < tail.length; j++ ) {
					ret.push( head.concat( tail[j] ) );
				}
				return ret;
			}
			
			function parse( expr, triples ) {
				for( var i=0; i < expr.length; i++ ) {
					if( typeOf( expr[i] ) == 'array' ) {
						parse( expr[i], triples );
					}
					else {
						if( triples.length == 0 ) {
							triples.push( [] );
						}
						if( triples[triples.length - 1].length < 3 ) {
							triples[triples.length - 1].push( expr[i] );
						}
						else {
							triples.push( [] );
							triples[triples.length - 1].push( expr[i] );
						}
					}
				}
			}
			
			/**
			* typeOf function published by Douglas Crockford in ECMAScript recommendations
			* http://www.crockford.com/javascript/recommend.html
			*/
			function typeOf(value) {
				var s = typeof value;
				if (s === 'object') {
					if (value) {
						if (typeof value.length === 'number' &&
								!(value.propertyIsEnumerable('length')) &&
								typeof value.splice === 'function') {
							s = 'array';
						}
					} else {
						s = 'null';
					}
				}
				return s;
			}

		</script>
	</head>
	<body onload="test();">
	</body>
</html>